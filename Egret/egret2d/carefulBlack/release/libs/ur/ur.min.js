var ur;!function(t){var i=function(){function t(t,i){this.x=t||0,this.y=i||0}var i=(__define,t);i.prototype;return t}();t.Point=i,egret.registerClass(i,"ur.Point");var n=function(){function t(t,i,n,e){this.x=t,this.y=i,this.width=n,this.height=e}var i=(__define,t);i.prototype;return t}();t.Rectangle=n,egret.registerClass(n,"ur.Rectangle");var e=function(){function t(t,i){this.name=t,this.score=i}var i=(__define,t);i.prototype;return t}();t.Result=e,egret.registerClass(e,"ur.Result");var s=function(){function t(){this.Origin=new i,this.Diagonal=0,this.HalfDiagonal=0,this._NumPoints=64,this._SquareSize=0,this._AngleRange=this.Deg2Rad(45),this._AnglePrecision=this.Deg2Rad(2),this._Phi=0,this.Unistrokes=[],this.SquareSize=250,this.AnglePrecision=2,this.AngleRange=45,this.Phi=.5*(-1+Math.sqrt(5)),this.NumPoints=64}var s=__define,r=t,h=r.prototype;return s(h,"Phi",function(){return this._Phi},function(t){this._Phi=t}),s(h,"SquareSize",function(){return this._SquareSize},function(t){this._SquareSize=t,this.Diagonal=Math.sqrt(this._SquareSize*this._SquareSize+this._SquareSize*this._SquareSize),this.HalfDiagonal=.5*this.Diagonal}),s(h,"AngleRange",function(){return this._AngleRange},function(t){this._AngleRange=this.Deg2Rad(t)}),s(h,"AnglePrecision",function(){return this._AnglePrecision},function(t){this._AnglePrecision=this.Deg2Rad(t)}),s(h,"NumPoints",function(){return this._NumPoints},function(t){this._NumPoints=t}),t.create=function(){return new t},h.Unistroke=function(t,i){var n={};n.Name=t,n.Points=this.Resample(i,this._NumPoints);var e=this.IndicativeAngle(n.Points);return n.Points=this.RotateBy(n.Points,-e),n.Points=this.ScaleTo(n.Points,this._SquareSize),n.Points=this.TranslateTo(n.Points,this.Origin),n.Vector=this.Vectorize(n.Points),n},h.recognize=function(t,i){t=this.Resample(t,this._NumPoints);var n=this.IndicativeAngle(t);t=this.RotateBy(t,-n),t=this.ScaleTo(t,this._SquareSize),t=this.TranslateTo(t,this.Origin);for(var s=this.Vectorize(t),r=+(1/0),h=-1,a=0;a<this.Unistrokes.length;a++){var o;o=i?this.OptimalCosineDistance(this.Unistrokes[a].Vector,s):this.DistanceAtBestAngle(t,this.Unistrokes[a],-this._AngleRange,+this._AngleRange,this._AnglePrecision),r>o&&(r=o,h=a)}return-1==h?new e("No match",0):new e(this.Unistrokes[h].Name,i?1/r:1-r/this.HalfDiagonal)},h.addGesture=function(t,i){this.Unistrokes[this.Unistrokes.length]=this.Unistroke(t,i)},h.deleteAllGestures=function(){this.Unistrokes.length=0},h.getGesture=function(t){var i=[];if(!t)return this.Unistrokes;for(var n=this.Unistrokes.length,e=0;n>e;e++)this.Unistrokes[e].Name==t&&i.push(this.Unistrokes[e]);return i},h.Resample=function(t,n){var e=this.PathLength(t)/(n-1),s=0,r=[t[0]];if(0>=e)return r;for(var h=1;h<t.length;h++){var a=this.Distance(t[h-1],t[h]);if(s+a>=e){var o=t[h-1].x+(e-s)/a*(t[h].x-t[h-1].x),u=t[h-1].y+(e-s)/a*(t[h].y-t[h-1].y),g=new i(o,u);r[r.length]=g,t.splice(h,0,g),s=0}else s+=a}return r.length==n-1&&(r[r.length]=new i(t[t.length-1].x,t[t.length-1].y)),r},h.IndicativeAngle=function(t){var i=this.Centroid(t);return Math.atan2(i.y-t[0].y,i.x-t[0].x)},h.RotateBy=function(t,n){for(var e=this.Centroid(t),s=Math.cos(n),r=Math.sin(n),h=new Array,a=0;a<t.length;a++){var o=(t[a].x-e.x)*s-(t[a].y-e.y)*r+e.x,u=(t[a].x-e.x)*r+(t[a].y-e.y)*s+e.y;h[h.length]=new i(o,u)}return h},h.ScaleTo=function(t,n){for(var e=this.BoundingBox(t),s=[],r=0;r<t.length;r++){var h=t[r].x*(n/e.width),a=t[r].y*(n/e.height);s[s.length]=new i(h,a)}return s},h.TranslateTo=function(t,n){for(var e=this.Centroid(t),s=[],r=0;r<t.length;r++){var h=t[r].x+n.x-e.x,a=t[r].y+n.y-e.y;s[s.length]=new i(h,a)}return s},h.Vectorize=function(t){for(var i=0,n=[],e=0;e<t.length;e++)n[n.length]=t[e].x,n[n.length]=t[e].y,i+=t[e].x*t[e].x+t[e].y*t[e].y;for(var s=Math.sqrt(i),e=0;e<n.length;e++)n[e]/=s;return n},h.OptimalCosineDistance=function(t,i){for(var n=0,e=0,s=0;s<t.length;s+=2)n+=t[s]*i[s]+t[s+1]*i[s+1],e+=t[s]*i[s+1]-t[s+1]*i[s];var r=Math.atan(e/n);return Math.acos(n*Math.cos(r)+e*Math.sin(r))},h.DistanceAtBestAngle=function(t,i,n,e,s){for(var r=this._Phi*n+(1-this._Phi)*e,h=this.DistanceAtAngle(t,i,r),a=(1-this._Phi)*n+this._Phi*e,o=this.DistanceAtAngle(t,i,a);Math.abs(e-n)>s;)o>h?(e=a,a=r,o=h,r=this._Phi*n+(1-this._Phi)*e,h=this.DistanceAtAngle(t,i,r)):(n=r,r=a,h=o,a=(1-this._Phi)*n+this._Phi*e,o=this.DistanceAtAngle(t,i,a));return Math.min(h,o)},h.DistanceAtAngle=function(t,i,n){var e=this.RotateBy(t,n);return this.PathDistance(e,i.Points)},h.Centroid=function(t){for(var n=0,e=0,s=0;s<t.length;s++)n+=t[s].x,e+=t[s].y;return n/=t.length,e/=t.length,new i(n,e)},h.BoundingBox=function(t){for(var i=+(1/0),e=-(1/0),s=+(1/0),r=-(1/0),h=0;h<t.length;h++)i=Math.min(i,t[h].x),s=Math.min(s,t[h].y),e=Math.max(e,t[h].x),r=Math.max(r,t[h].y);return new n(i,s,e-i,r-s)},h.PathDistance=function(t,i){for(var n=0,e=0;e<t.length;e++)n+=this.Distance(t[e],i[e]);return n/t.length},h.PathLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=this.Distance(t[n-1],t[n]);return i},h.Distance=function(t,i){var n=i.x-t.x,e=i.y-t.y;return parseFloat(Math.sqrt(n*n+e*e).toFixed(2))},h.Deg2Rad=function(t){return t*Math.PI/180},t}();t.UnistrokeRecognize=s,egret.registerClass(s,"ur.UnistrokeRecognize")}(ur||(ur={}));