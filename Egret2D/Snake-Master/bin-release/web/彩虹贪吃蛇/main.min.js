var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},Food=function(t){function i(i,e,s){var h=t.call(this)||this;return h.init(i,e,s),h}return __extends(i,t),i.prototype.init=function(t,i,e){this.color=this.randomColor(),this.food=new egret.Shape,this.food.graphics.beginFill(this.color),this.food.graphics.drawCircle(0,0,e),this.food.graphics.endFill(),this.food.x=e,this.food.y=e,this.x=t,this.y=i,this.addChild(this.food)},i.prototype.randomColor=function(){return parseInt("0x"+("000000"+(16777215*Math.random()+.5>>0).toString(16)).slice(-6))},i.prototype.onEat=function(){this.parent.removeChild(this)},i}(egret.Sprite);Food.colorList=[7402495,16729631,48146,2205301,4989467,12526634,1447971,16753664],__reflect(Food.prototype,"Food");var LoadingUI=function(t){function i(){var i=t.call(this)||this;return i.createView(),i}return __extends(i,t),i.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.prototype.setProgress=function(t,i){this.textField.text="Loading..."+t+"/"+i},i}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function i(){var i=t.call(this)||this;return i.radius=30,i.color=5017006,i.score=0,i.modal="当前得分:",i.during=40,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.createGameScene,i),i}return __extends(i,t),i.prototype.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=new egret.Shape;t.graphics.drawRect(0,0,this.stageW,this.stageH),t.graphics.endFill(),this.addChild(t),this.drawScore(),this.drawScoreMoadl(),this.randomFood(),this.snake=new Snake(.5*this.stageW,.5*this.stageH,this.radius,0),this.addChild(this.snake),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.move,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.moveEnd,this);var i=this;document.addEventListener("keydown",function(t){switch(t.keyCode){case 38:i.doMove()}})},i.prototype.doMove=function(){var t=1e3;this.head.y-=10;var i;i=egret.Tween.get(this.head.y),i.to({x:this.head.x,y:this.head.y},t)},i.prototype.onEat=function(){this.removeChild(this.food),this.score+=1,this.num.text=this.score.toString(),this.addChild(this.num),this.snake.afterEat(this.food.color),this.randomFood()},i.prototype.randomFood=function(){var t=Math.random()*(this.stageW-2*this.radius),i=Math.random()*(this.stageH-2*this.radius);this.food=new Food(t,i,this.radius),this.addChild(this.food)},i.prototype.drawScore=function(){this.num=new egret.TextField,this.num.text=this.score.toString(),this.num.size=50,this.num.width=200,this.num.x=120,this.num.textColor=0,this.num.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this.num)},i.prototype.drawScoreMoadl=function(){this.scoreModal=new egret.TextField,this.scoreModal.text=this.modal.toString(),this.scoreModal.size=40,this.scoreModal.width=300,this.scoreModal.x=2,this.scoreModal.y=5,this.scoreModal.textColor=0,this.scoreModal.textAlign=egret.HorizontalAlign.LEFT,this.addChild(this.scoreModal)},i.prototype.move=function(t){this.snake.move(t,this.during)},i.prototype.onMove=function(t){this.moveEvent=t,null==this.timer&&(this.timer=new egret.Timer(this.during),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.start())},i.prototype.moveEnd=function(t){null!=this.timer&&(this.timer.stop(),this.timer=null)},i.prototype.onTimer=function(t){this.head=this.snake.getHead(),this.hit(this.head,this.food)&&this.onEat(),this.snake.move(this.moveEvent,this.during)},i.prototype.hit=function(t,i){return new egret.Rectangle(t.x+this.snake.x,t.y+this.snake.y,t.width,t.height).intersects(new egret.Rectangle(i.x,i.y,i.width,i.height))},i}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Snake=function(t){function i(i,e,s,h){var o=t.call(this)||this;return o.bodyList=[],o.speed=20,o.init(i,e,s,h),o}return __extends(i,t),i.prototype.init=function(t,i,e,s){this.head=new egret.Shape,this.head.graphics.lineStyle(10,16729975),this.head.graphics.beginFill(s),this.head.graphics.drawCircle(e,e,e),this.head.graphics.endFill(),this.head.x=0,this.head.y=0,this.radius=e,this.x=t,this.y=i,this.bodyList.push(this.head),this.addChild(this.bodyList[this.bodyList.length-1]),this.setChildIndex(this.bodyList[this.bodyList.length-1],-999)},i.prototype.afterEat=function(t){var i=new egret.Shape;i.graphics.beginFill(t),i.graphics.drawCircle(this.radius,this.radius,this.radius),i.graphics.endFill(),i.x=this.bodyList[this.bodyList.length-1].x+.6*this.radius,i.y=this.bodyList[this.bodyList.length-1].y+.6*this.radius,this.bodyList.push(i),this.addChild(this.bodyList[this.bodyList.length-1]),this.setChildIndex(this.bodyList[this.bodyList.length-1],0)},i.prototype.move=function(t,i){for(var e,s=t.stageX,h=t.stageY,o=this.bodyList.length-1;o>=1;o--)e=egret.Tween.get(this.bodyList[o]),e.to({x:this.bodyList[o-1].x,y:this.bodyList[o-1].y},i);var n=this.x+this.bodyList[0].x,r=this.y+this.bodyList[0].y;d=this.bodyList[0].x-this.speed*Math.cos(l),a=this.bodyList[0].y-this.speed*Math.sin(l),e=egret.Tween.get(this.bodyList[0]);var d,a;if(n!=s||r!=h)if(n!=s){var c=(h-r)/(s-n),l=Math.atan(c);n>s?(d=this.bodyList[0].x-this.speed*Math.cos(l),a=this.bodyList[0].y-this.speed*Math.sin(l),e.to({x:d,y:a},i)):(d=this.bodyList[0].x+this.speed*Math.cos(l),a=this.bodyList[0].y+this.speed*Math.sin(l),e.to({x:d,y:a},i))}else n>s?(d=this.bodyList[0].x-this.speed,e.to({x:d,y:a},i)):(d=this.bodyList[0].x+this.speed,e.to({x:d,y:a},i))},i.prototype.getHead=function(){return this.bodyList[0]},i}(egret.Sprite);__reflect(Snake.prototype,"Snake");